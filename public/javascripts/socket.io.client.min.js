var socket=io.connect();socket.on("connect",function(){$("#chat").addClass("connected")});socket.on("announcement",function(a){$("#lines").append($("<p>").append($("<em>").text(a)))});socket.on("nicknames",function(a){$("#nicknames").empty().append($("<button onclick=\"$('#chat').fadeOut()\">X</button>"));$("#nicknames").append($("<span>Online: </span>"));for(var b in a)$("#nicknames").append($("<b>").text(a[b]))});socket.on("user message",message);
socket.on("reconnect",function(){$("#lines").remove();message("System","Reconnected to the server")});socket.on("reconnecting",function(){message("System","Attempting to re-connect to the server")});socket.on("error",function(a){message("System",a?a:"A unknown error occurred")});function message(a,b){$("#lines").append($("<p>").append($("<b>").text(a),b))}
$(function(){function a(){$("#message").val("").focus()}$("#set-nickname").submit(function(){socket.emit("nickname",$("#nick").val(),function(b){if(!b)return a(),$("#chat").addClass("nickname-set");$("#nickname-err").css("visibility","visible")});return!1});$("#send-message").submit(function(){message("me",$("#message").val());socket.emit("user message",$("#message").val(),c.order,c.albom);a();$("#lines").get(0).scrollTop=1E7;return!1})});
